import{_ as s,o as a,c as p,Q as l}from"./chunks/framework.b699761e.js";const o="/SAW/tool.svg",C=JSON.parse('{"title":"工具","description":"","frontmatter":{},"headers":[],"relativePath":"guide/start/tool.md","filePath":"guide/start/tool.md","lastUpdated":null}'),n={name:"guide/start/tool.md"},e=l('<h1 id="工具" tabindex="-1">工具 <a class="header-anchor" href="#工具" aria-label="Permalink to &quot;工具&quot;">​</a></h1><p><img src="'+o+`" alt="支持的协议转换功能"><br> 除了利用已经实现WHIP协议的原生平台外，SAW添加了<strong>可以实现rtp和WHIP或WHEP相互转换</strong>的工具，使其可以兼容更多的媒体播放器。</p><div class="tip custom-block"><p class="custom-block-title">例如</p><p><code>ffmpeg -&gt; whipinto -&gt; SAW -&gt; whepfrom -&gt; ffplay</code></p></div><h2 id="whipinto" tabindex="-1">whipinto <a class="header-anchor" href="#whipinto" aria-label="Permalink to &quot;whipinto&quot;">​</a></h2><ul><li>编译</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cargo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--package=whipinto</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--release</span></span>
<span class="line"><span style="color:#B392F0;">whipinto</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vp8</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-u</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:3000/whip/777</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5003</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cargo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--package=whipinto</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--release</span></span>
<span class="line"><span style="color:#6F42C1;">whipinto</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vp8</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-u</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:3000/whip/777</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5003</span></span></code></pre></div><ul><li>视频源测试，以ffmpeg<a href="https://ffmpeg.org/download.html" target="_blank" rel="noreferrer">开始下载</a>为例：</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">ffmpeg</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-re</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lavfi</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">testsrc=size=</span><span style="color:#79B8FF;">640</span><span style="color:#9ECBFF;">x480:rate=</span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-vcodec</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libvpx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rtp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;rtp://127.0.0.1:5003?pkt_size=1200&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">ffmpeg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-re</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lavfi</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">testsrc=size=</span><span style="color:#005CC5;">640</span><span style="color:#032F62;">x480:rate=</span><span style="color:#005CC5;">30</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-vcodec</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libvpx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rtp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;rtp://127.0.0.1:5003?pkt_size=1200&#39;</span></span></code></pre></div><blockquote><p><em>注:<strong>支持参数命令</strong></em></p></blockquote><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cargo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--package=whipinto</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vp8</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-u</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:3000/whip/777</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--command</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;ffmpeg -re -f lavfi -i testsrc=size=640x480:rate=30 -vcodec libvpx -cpu-used 5 -deadline 1 -g 10 -error-resilient 1 -auto-alt-ref 1 -f rtp &#39;rtp://127.0.0.1:{port}?pkt_size=1200&#39;&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cargo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--package=whipinto</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vp8</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-u</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:3000/whip/777</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--command</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">&quot;ffmpeg -re -f lavfi -i testsrc=size=640x480:rate=30 -vcodec libvpx -cpu-used 5 -deadline 1 -g 10 -error-resilient 1 -auto-alt-ref 1 -f rtp &#39;rtp://127.0.0.1:{port}?pkt_size=1200&#39;&quot;</span></span></code></pre></div><ul><li>在VLC<a href="https://www.videolan.org/vlc/" target="_blank" rel="noreferrer">开始下载</a> 中的RTP流</li></ul><blockquote><p><em>注: VLC不能支持所有的视频编码格式</em></p></blockquote><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">vlc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-vvv</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">INPUT_FIL</span><span style="color:#E1E4E8;">E</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--sout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;#transcode{vcodec=h264}:rtp{dst=127.0.0.1,port=5003}&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">vlc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-vvv</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">INPUT_FIL</span><span style="color:#24292E;">E</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--sout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;#transcode{vcodec=h264}:rtp{dst=127.0.0.1,port=5003}&#39;</span></span></code></pre></div><h2 id="whepform" tabindex="-1">whepform <a class="header-anchor" href="#whepform" aria-label="Permalink to &quot;whepform&quot;">​</a></h2><ul><li>编译</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cargo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--package=whepfrom</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--release</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cargo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--package=whepfrom</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--release</span></span></code></pre></div><ul><li>将发送的RTP协议转换WHEP，再使用WHEP协议拉流</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">whepfrom</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vp8</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-u</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:3000/whep/777</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:5004</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">whepfrom</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vp8</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-u</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:3000/whep/777</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:5004</span></span></code></pre></div><ul><li>Use ffplay</li></ul><details class="details custom-block"><summary>ffplay的使用</summary><ul><li>对于 ffplay, 需要一个SDP文件</li></ul><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">cat &gt; stream.sdp &lt;&lt; EOF</span></span>
<span class="line"><span style="color:#e1e4e8;">v=0</span></span>
<span class="line"><span style="color:#e1e4e8;">m=video 5004 RTP/AVP 96</span></span>
<span class="line"><span style="color:#e1e4e8;">c=IN IP4 127.0.0.1</span></span>
<span class="line"><span style="color:#e1e4e8;">a=rtpmap:96 VP8/90000</span></span>
<span class="line"><span style="color:#e1e4e8;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">cat &gt; stream.sdp &lt;&lt; EOF</span></span>
<span class="line"><span style="color:#24292e;">v=0</span></span>
<span class="line"><span style="color:#24292e;">m=video 5004 RTP/AVP 96</span></span>
<span class="line"><span style="color:#24292e;">c=IN IP4 127.0.0.1</span></span>
<span class="line"><span style="color:#24292e;">a=rtpmap:96 VP8/90000</span></span>
<span class="line"><span style="color:#24292e;">EOF</span></span></code></pre></div><ul><li>使用 ffplay</li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">ffplay</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-protocol_whitelist</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rtp,file,udp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stream.sdp</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">ffplay</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-protocol_whitelist</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rtp,file,udp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stream.sdp</span></span></code></pre></div><ul><li><em>因此，建议如下使用：</em></li></ul><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cargo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--package=whepfrom</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vp8</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-u</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:3000/whep/777</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1:5004</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--command</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;ffplay -protocol_whitelist rtp,file,udp -i stream.sdp&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cargo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--package=whepfrom</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vp8</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-u</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:3000/whep/777</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1:5004</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--command</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;ffplay -protocol_whitelist rtp,file,udp -i stream.sdp&#39;</span></span></code></pre></div></details><ul><li>使用 VLC 播放器</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">vlc stream.sdp</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">vlc stream.sdp</span></span></code></pre></div>`,22),t=[e];function c(r,y,i,E,d,F){return a(),p("div",null,t)}const u=s(n,[["render",c]]);export{C as __pageData,u as default};
